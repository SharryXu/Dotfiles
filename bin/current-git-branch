#!/usr/bin/env bash

# Acquire current git branch name.
# Globals:
#   git
#   is-git-repo
#   color-print
# Arguments:
#   folder path
# Returns:
#   IsAlive

function usage() {
  echo -e "usage: $(basename "$0") folder_path"

  exit 1
}

function print_branch() {
  local branch_name
  branch_name=$(git symbolic-ref --short HEAD 2>/dev/null)

  if [[ -z "$branch_name" ]]; then
    color-print 3 "Not on any branch."

    return 1;
  else
    # Cannot colour this output!!!
    echo "$branch_name"

    return 0;
  fi
}

if [[ $# -eq 1 ]]; then
  folder_path=$(realpath "$1")
else
  folder_path=$(realpath ".")
fi

if is-git-repo "$folder_path"; then
  cd "$folder_path" || exit 1

  if print_branch; then
    cd - 1>/dev/null || exit 1
    exit 0
  else
    cd - 1>/dev/null || exit 1
    exit 1
  fi
else
  color-print 3 "$folder_path is not a valid git repository."

  exit 1
fi
